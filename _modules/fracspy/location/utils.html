

<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>fracspy.location.utils &#8212; fracspy</title>
    

  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/style.css?v=e5b2244c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=e45f66c9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/fracspy/location/utils';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    
    <script src="../../../_static/require.js"></script>

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">fracspy</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../index.html">
    FraCSPy
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../gallery/index.html">
    Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/index.html">
    FraCSPy API
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../index.html">
    FraCSPy
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../gallery/index.html">
    Gallery
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../tutorials/index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../../api/index.html">
    FraCSPy API
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">fracspy.loca...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for fracspy.location.utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">_get_centroid</span><span class="p">(</span><span class="n">array_xyz</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array_xyz</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="get_max_locs">
<a class="viewcode-back" href="../../../api/generated/fracspy.location.utils.get_max_locs.html#fracspy.location.utils.get_max_locs">[docs]</a>
<span class="k">def</span> <span class="nf">get_max_locs</span><span class="p">(</span><span class="n">ssimage</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rem_edge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgebuf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">absval</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">absval</span><span class="p">:</span> <span class="n">ssimage</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">ssimage</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rem_edge</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ssimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">cropped_image</span> <span class="o">=</span> <span class="n">ssimage</span><span class="p">[</span><span class="n">edgebuf</span><span class="p">:</span><span class="o">-</span><span class="n">edgebuf</span><span class="p">,</span> <span class="n">edgebuf</span><span class="p">:</span><span class="o">-</span><span class="n">edgebuf</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ssimage</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">cropped_image</span> <span class="o">=</span> <span class="n">ssimage</span><span class="p">[</span><span class="n">edgebuf</span><span class="p">:</span><span class="o">-</span><span class="n">edgebuf</span><span class="p">,</span> <span class="n">edgebuf</span><span class="p">:</span><span class="o">-</span><span class="n">edgebuf</span><span class="p">,</span>  <span class="n">edgebuf</span><span class="p">:</span><span class="o">-</span><span class="n">edgebuf</span><span class="p">]</span>
        <span class="n">ev_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">cropped_image</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">n_max</span><span class="p">)[</span><span class="o">-</span><span class="n">n_max</span><span class="p">:],</span>
                                            <span class="n">cropped_image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="n">ev_locs</span> <span class="o">=</span> <span class="n">ev_locs</span> <span class="o">+</span> <span class="n">edgebuf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ev_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">(</span><span class="n">ssimage</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">n_max</span><span class="p">)[</span><span class="o">-</span><span class="n">n_max</span><span class="p">:],</span>
                                         <span class="n">ssimage</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">n_max</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ev_loc</span> <span class="o">=</span> <span class="n">_get_centroid</span><span class="p">(</span><span class="n">ev_locs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">ev_loc</span> <span class="o">=</span> <span class="n">ev_locs</span>

    <span class="k">return</span> <span class="n">ev_loc</span><span class="p">,</span> <span class="n">ev_locs</span></div>



<span class="k">def</span> <span class="nf">dist2rec</span><span class="p">(</span><span class="n">recs</span><span class="p">,</span> <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Compute distances from a 3D grid of points to array of receivers </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    recs - receiver coordinates [3,nr]</span>
<span class="sd">    gx - x coordinates of a grid [1,ngx]</span>
<span class="sd">    gy - y coordinates of a grid [1,ngy] </span>
<span class="sd">    gz - z coordinates of a grid [1,ngz]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    d - 4D array of distances [nr,ngx,ngy,ngz]</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nr</span> <span class="o">=</span> <span class="n">recs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">,</span> <span class="n">gz</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">recs</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">gx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">recs</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">gy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">recs</span><span class="p">[</span><span class="mi">2</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">gz</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>


<span class="k">def</span> <span class="nf">moveout_correction</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">itshifts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Moveout correction for microseismic data.</span>

<span class="sd">    This function applies a moveout correction to microsseismic data by shifting each sample in time according to its corresponding shift value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data - input seismic data [nr, nt]</span>
<span class="sd">    itshifts - array of shift values [nr]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data_corrected - microseismic data with corrected moveout [nr, nt]</span>

<span class="sd">    Notes</span>
<span class="sd">    ----</span>
<span class="sd">    The function checks that all values in `itshifts` are non-negative and that the length of `itshifts` matches the number of rows in `data`.</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; # Assuming you have a 2D array &quot;data&quot; with shape (nr, nt) and an array &quot;itshifts&quot; with shape (nr,)</span>
<span class="sd">    &gt;&gt;&gt; corrected_data = moveout_correction(data, itshifts)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get size</span>
    <span class="n">nr</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Check size</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">itshifts</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nr</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The length of itshifts must match the number of rows in data.&quot;</span><span class="p">)</span>
    
    <span class="n">data_corrected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>  <span class="c1"># Create an array of zeros with the same shape as data</span>

    <span class="c1"># Check if all values in itshifts are positive</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">itshifts</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All values in itshifts must be non-negative.&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the shifted indices for each row</span>
    <span class="c1">#shifted_indices = np.arange(nt) - itshifts[:, np.newaxis]</span>
    <span class="n">shifted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">-</span> <span class="n">itshifts</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    
    <span class="c1"># Clip indices to ensure they stay within bounds</span>
    <span class="n">shifted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">shifted_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Copy values from data to result using fancy indexing</span>
    <span class="n">data_corrected</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">shifted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

    <span class="c1"># # Loop through each row</span>
    <span class="c1"># for i in range(nr):</span>
    <span class="c1">#     # Calculate the shift for this row</span>
    <span class="c1">#     shift = int(itshifts[i])</span>
        
    <span class="c1">#     # Move values towards the beginning of the array</span>
    <span class="c1">#     #data_corrected[i, :shift] = 0  # Fill the gap with zeros</span>
    <span class="c1">#     data_corrected[i, shift:] = data[i, :-shift]  # Move values</span>

    <span class="k">return</span> <span class="n">data_corrected</span>


<span class="k">def</span> <span class="nf">semblance_stack</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Computes the semblance stack for a given input array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data - The input array with shape (nr, nt), where nr is the number of receivers and nt is the number of time samples, usually microseismic data with corrected moveout [nr, nt]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    semblance_values: A 1D array with shape (nt,) containing the semblance values for each time sample.</span>

<span class="sd">    Description</span>
<span class="sd">    -------</span>
<span class="sd">    The semblance_stack function computes the semblance stack, which is a measure of the coherence or similarity between the seismic data and the noise. </span>
<span class="sd">    The semblance value at each time sample is calculated as the ratio of the numerator (the sum of squared amplitudes) to the denominator (the sum of squares of the total amplitude minus the square of the sum).</span>

<span class="sd">    Mathematical Formula</span>
<span class="sd">    -------</span>
<span class="sd">    The formula for computing the semblance stack is:</span>

<span class="sd">    semblance = numerator / denominator</span>

<span class="sd">    where:</span>

<span class="sd">    numerator = Σ(data^2, axis=0)</span>
<span class="sd">    denominator = nr * Σ(data^2, axis=0) - (Σ(data, axis=0))^2</span>
<span class="sd">    nr is the number of receivers</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -------</span>
<span class="sd">    The function initializes an array semblance_values with shape (nt,) to store the semblance values.</span>
<span class="sd">    It then computes the numerator and denominator of the semblance equation using NumPy operations.</span>
<span class="sd">    To avoid division by zero, it sets any denominators that are equal to zero to a small value (1e-10).</span>
<span class="sd">    Finally, it returns the computed semblance values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get the shape of the input data, which should be (nr, nt)</span>
    <span class="n">nr</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    
    <span class="c1"># Initialize an array to store the semblance values</span>
    <span class="c1"># The size of this array is determined by the number of time samples (nt)</span>
    <span class="n">semblance_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the numerator and denominator of the semblance equation</span>
<span class="sd">    The numerator is the sum of squared amplitudes, and the denominator is a function </span>
<span class="sd">    of the total amplitude and the square root of the variance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute the numerator of the semblance equation</span>
    <span class="c1"># This is simply the sum of the squares of each data point</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Compute the denominator of the semblance equation</span>
    <span class="c1"># The denominator is a function of the total amplitude and the square root of the variance</span>
    <span class="n">sum_data_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">nr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">sum_data_squared</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check for division by zero and set any zeros to a small value (1e-10)</span>
<span class="sd">    This is necessary because the denominator cannot be zero</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Avoid division by zero</span>
    <span class="n">denominator</span><span class="p">[</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-10</span>

    <span class="c1"># Compute the semblance values using the numerator and denominator</span>
    <span class="c1"># The semblance value at each time sample is calculated as the ratio of the numerator to the denominator</span>
    <span class="n">semblance_values</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

    <span class="k">return</span> <span class="n">semblance_values</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, fracspy Development Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>